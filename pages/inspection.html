<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SARTHI - Inspection</title>

  <!-- ‚úÖ Bootstrap & AOS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css" rel="stylesheet">

  <!-- ‚úÖ Correct relative path to assets -->
  <link href="../assets/css/styles.css" rel="stylesheet">
</head>
<body>
  <!-- ‚úÖ Navbar Component -->
  <div id="navbar-container"></div>

  <!-- Main Container -->
  <div class="container-fluid py-4">
    <div class="row justify-content-center">
      <main id="content" class="col-12 col-md-8 col-lg-6">
        <h1 class="h3 mb-4" data-aos="fade-up">Inspection Entry Form</h1>

        <div class="card shadow-sm" data-aos="fade-up" data-aos-delay="100">
          <div class="card-body">
            <form id="inspectionForm" class="row g-4">

              <!-- Product -->
              <div class="col-12">
                <label for="productSelect" class="form-label fw-semibold">Product to be Inspected</label>
                <select class="form-select" id="productSelect" required>
                  <option value="" disabled selected>Select Product</option>
                  <option value="ERC">ERC</option>
                  <option value="Sleeper">Sleeper</option>
                  <option value="GRSP">GRSP</option>
                  <option value="Elastomeric Pad">Elastomeric Pad</option>
                  <option value="Rail">Rail</option>
                </select>
              </div>

              <!-- Manufacturer -->
              <div class="col-12">
                <label for="manufacturerSelect" class="form-label fw-semibold">Select Manufacturer Name</label>
                <select class="form-select" id="manufacturerSelect" required disabled>
                  <option value="" disabled selected>Select Manufacturer</option>
                </select>
              </div>

              <!-- Stage -->
              <div class="col-12">
                <label for="stageSelect" class="form-label fw-semibold">Select Inspection Stage</label>
                <select class="form-select" id="stageSelect" required>
                  <option value="" disabled selected>Select Stage</option>
                  <option value="Raw Material">Raw Material</option>
                  <option value="Process">Process</option>
                  <option value="Final">Final</option>
                </select>
              </div>

               <div class="col-12">
                <label for="inspectionDate" class="form-label fw-semibold">Date of Inspection</label>
                <input type="date" class="form-control" id="inspectionDate" required>
              </div>

              <!-- üïí Shift of Inspection -->
              <div class="col-12">
                <label for="inspectionShift" class="form-label fw-semibold">Shift of Inspection</label>
                <select class="form-select" id="inspectionShift" required>
                  <option value="" disabled selected>Select Shift</option>
                  <option value="A">A</option>
                  <option value="B">B</option>
                  <option value="C">C</option>
                  <option value="G">G</option>
                </select>
              </div>

              <!-- üè∑ Type of Product -->
              <div class="col-12">
                <label for="productType" class="form-label fw-semibold">Type of Product</label>
                <select class="form-select" id="productType" required>
                  <option value="" disabled selected>Select Type</option>
                </select>
              </div>

              <!-- Submit -->
              <div class="col-12 d-flex justify-content-center mt-3">
                <button type="submit" class="btn btn-primary px-5">Start Duty</button>
              </div>

            </form>
          </div>
        </div>
      </main>
    </div>
  </div>

  <footer class="border-top py-3 mt-4 text-center small text-muted">
    ¬© SARTHI - QIMS ‚Äî v0.1
  </footer>

  <!-- ‚úÖ JS Libraries -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js"></script>

  <!-- ‚úÖ Correct relative path to app.js -->
  <script src="../assets/js/app.js"></script>

  <script>
    AOS.init({ duration: 800, once: true });

    // ‚úÖ Manufacturer Data
    const manufacturers = {
      'Sleeper': ['Sleeper Manufacturer 1', 'Sleeper Manufacturer 2'],
      'ERC': ['ERC Manufacturer 1', 'ERC Manufacturer 2'],
      'GRSP': ['GRSP Manufacturer 1', 'GRSP Manufacturer 2'],
      'Elastomeric Pad': ['Elasto Manufacturer 1', 'Elasto Manufacturer 2'],
      'Rail': ['Rail Manufacturer 1', 'Rail Manufacturer 2']
    };

    // ‚úÖ Product Type Data (Dynamic)
    const productTypes = {
      'ERC': ['MK III', 'MK V'],
      'Sleeper': ['PSC', 'Mono Block', 'Pre-stressed'],
      'GRSP': ['Type A', 'Type B'],
      'Elastomeric Pad': ['Type 1', 'Type 2'],
      'Rail': ['52 Kg', '60 Kg', 'Head Hardened']
    };

    const productSelect = document.getElementById('productSelect');
    const manufacturerSelect = document.getElementById('manufacturerSelect');
    const productTypeSelect = document.getElementById('productType');

    // ‚úÖ Update Manufacturer and Product Type when Product changes
    productSelect.addEventListener('change', () => {
      const selectedProduct = productSelect.value;

      // Manufacturer
      manufacturerSelect.innerHTML = '<option value="" disabled selected>Select Manufacturer</option>';
      if (manufacturers[selectedProduct]) {
        manufacturers[selectedProduct].forEach(name => {
          const opt = document.createElement('option');
          opt.value = name;
          opt.textContent = name;
          manufacturerSelect.appendChild(opt);
        });
        manufacturerSelect.disabled = false;
      } else {
        manufacturerSelect.disabled = true;
      }

      // Product Type
      productTypeSelect.innerHTML = '<option value="" disabled selected>Select Type</option>';
      if (productTypes[selectedProduct]) {
        productTypes[selectedProduct].forEach(type => {
          const opt = document.createElement('option');
          opt.value = type;
          opt.textContent = type;
          productTypeSelect.appendChild(opt);
        });
        productTypeSelect.disabled = false;
      } else {
        productTypeSelect.disabled = true;
      }
    });

    // ‚úÖ Redirect Map (Relative paths ‚Äî no leading slash)
    const redirectMap = {
      'ERC': {
        'Raw Material': 'erc_raw_material_inspection_dashboard.html',
        'Process': 'erc_process_inspection_dashboard.html',
        'Final': 'erc_final_start_duty.html'
      },
      'Sleeper': {
        'Raw Material': 'sleeper_raw_material_start_duty.html',
        'Process': 'sleeper_process_start_duty.html',
        'Final': 'sleeper_final_start_duty.html'
      },
      'GRSP': {
        'Raw Material': 'grsp_raw_material_start_duty.html',
        'Process': 'grsp_process_start_duty.html',
        'Final': 'grsp_final_start_duty.html'
      },
      'Elastomeric Pad': {
        'Raw Material': 'elastomeric_raw_material_start_duty.html',
        'Process': 'elastomeric_process_start_duty.html',
        'Final': 'elastomeric_final_start_duty.html'
      },
      'Rail': {
        'Raw Material': 'rail_raw_material_start_duty.html',
        'Process': 'rail_process_start_duty.html',
        'Final': 'rail_final_start_duty.html'
      }
    };

    // ‚úÖ Handle Form Submission
    document.getElementById('inspectionForm').addEventListener('submit', (e) => {
      e.preventDefault();
      const product = productSelect.value;
      const stage = document.getElementById('stageSelect').value;
      const redirectUrl = redirectMap[product]?.[stage];

      console.log('Redirecting to:', redirectUrl);

      if (redirectUrl) {
        // stays inside the same folder (/pages)
        window.location.href = redirectUrl;
      } else {
        alert(`‚ùå No page defined for ${product} - ${stage}`);
      }
    });
  </script>
</body>
</html>
