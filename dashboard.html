<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SARTHI - Railway Inspection Dashboard</title>

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- AOS -->
  <link href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css" rel="stylesheet">
  <!-- Custom CSS -->
  <link href="assets/css/styles.css" rel="stylesheet">
</head>
<body>


  <!-- ‚úÖ Navbar Component -->
  <div id="navbar-container"></div>

  <!-- Main Container -->
  <div class="container-fluid py-4">
    <div class="row">
      <!-- Main Content -->
      <main id="content" class="col-12">
        <h1 class="h3 mb-4" data-aos="fade-up">Dashboard</h1>

        <!-- Filters Section -->
        <div class="row mb-4" data-aos="fade-up" data-aos-delay="50">
          <div class="col-12 col-md-6 col-lg-3 mb-3">
            <label for="zonalRailwayFilter" class="form-label fw-semibold">Zonal Railway</label>
            <select class="form-select" id="zonalRailwayFilter">
              <option value="all" selected>All Zonal Railways</option>
              <option value="CR">Central Railway (CR)</option>
              <option value="ER">Eastern Railway (ER)</option>
              <option value="ECR">East Central Railway (ECR)</option>
              <option value="ECoR">East Coast Railway (ECoR)</option>
              <option value="NR">Northern Railway (NR)</option>
              <option value="NCR">North Central Railway (NCR)</option>
              <option value="NER">North Eastern Railway (NER)</option>
              <option value="NFR">Northeast Frontier Railway (NFR)</option>
              <option value="NWR">North Western Railway (NWR)</option>
              <option value="SR">Southern Railway (SR)</option>
              <option value="SCR">South Central Railway (SCR)</option>
              <option value="SECR">South East Central Railway (SECR)</option>
              <option value="SER">South Eastern Railway (SER)</option>
              <option value="SWR">South Western Railway (SWR)</option>
              <option value="WR">Western Railway (WR)</option>
              <option value="WCR">West Central Railway (WCR)</option>
              <option value="Metro">Metro Railway (Kolkata)</option>
            </select>
          </div>
          <div class="col-12 col-md-6 col-lg-3 mb-3">
            <label for="ritesOfficeFilter" class="form-label fw-semibold">RITES Regional Office</label>
            <select class="form-select" id="ritesOfficeFilter">
              <option value="all" selected>All Regional Offices</option>
              <option value="delhi">NRIO</option>
              <option value="mumbai">WRIO</option>
              <option value="kolkata">ERIO</option>
              <option value="chennai">SRIO</option>
              <option value="bangalore">CRIO</option>
            </select>
          </div>
        </div>

        <div class="mb-4" data-aos="fade-up" data-aos-delay="100">
          <div class="btn-group flex-wrap" role="group" aria-label="Product Toggle Buttons">
            <input type="radio" class="btn-check" name="productToggle" id="btnERC" autocomplete="off" checked>
            <label class="btn btn-outline-primary" for="btnERC">ERC</label>

            <input type="radio" class="btn-check" name="productToggle" id="btnSleeper" autocomplete="off">
            <label class="btn btn-outline-primary" for="btnSleeper">Sleeper</label>

            <input type="radio" class="btn-check" name="productToggle" id="btnRubberPad" autocomplete="off">
            <label class="btn btn-outline-primary" for="btnRubberPad">GRSP</label>

            <input type="radio" class="btn-check" name="productToggle" id="btnElastomeric" autocomplete="off">
            <label class="btn btn-outline-primary" for="btnElastomeric">Elastomeric Pad</label>

            <input type="radio" class="btn-check" name="productToggle" id="btnRail" autocomplete="off">
            <label class="btn btn-outline-primary" for="btnRail">Rail</label>
          </div>
        </div>

        <!-- KPI Cards - Dual Metrics (PO Count & Quantity) -->
        <div class="row g-4 mb-4">
          <!-- Card 1: PO Placed / Qty Offered -->
          <div class="col-12 col-sm-6 col-lg-3">
            <div class="card hover-lift border-primary" style="border-left: 4px solid #0d6efd;">
              <div class="card-body">
                <div class="d-flex justify-content-between align-items-start mb-3">
                  <h6 class="card-subtitle text-muted mb-0">PO Placed / Qty Offered</h6>
                  <div class="fs-3">üì¶</div>
                </div>
                <div class="row">
                  <div class="col-6">
                    <p class="text-muted mb-1 small">PO Count</p>
                    <h4 class="mb-0 text-primary" id="poPlaced">45</h4>
                  </div>
                  <div class="col-6">
                    <p class="text-muted mb-1 small">Qty Offered</p>
                    <h4 class="mb-0 text-primary" id="qtyOffered">5,200</h4>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Card 2: PO Under Inspection / Qty Inspected -->
          <div class="col-12 col-sm-6 col-lg-3">
            <div class="card hover-lift border-warning" style="border-left: 4px solid #ffc107;">
              <div class="card-body">
                <div class="d-flex justify-content-between align-items-start mb-3">
                  <h6 class="card-subtitle text-muted mb-0">PO Under Inspection / Qty Inspected</h6>
                  <div class="fs-3">üîç</div>
                </div>
                <div class="row">
                  <div class="col-6">
                    <p class="text-muted mb-1 small">PO Count</p>
                    <h4 class="mb-0 text-warning" id="poUnderInspection">18</h4>
                  </div>
                  <div class="col-6">
                    <p class="text-muted mb-1 small">Qty Inspected</p>
                    <h4 class="mb-0 text-warning" id="qtyInspected">3,444</h4>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Card 3: PO Pending / Qty Accepted -->
          <div class="col-12 col-sm-6 col-lg-3">
            <div class="card hover-lift border-success" style="border-left: 4px solid #198754;">
              <div class="card-body">
                <div class="d-flex justify-content-between align-items-start mb-3">
                  <h6 class="card-subtitle text-muted mb-0">PO Pending / Qty Accepted</h6>
                  <div class="fs-3">‚è≥</div>
                </div>
                <div class="row">
                  <div class="col-6">
                    <p class="text-muted mb-1 small">PO Pending</p>
                    <h4 class="mb-0 text-info" id="poPending">12</h4>
                  </div>
                  <div class="col-6">
                    <p class="text-muted mb-1 small">Qty Accepted</p>
                    <h4 class="mb-0 text-success" id="qtyAccepted">3,000</h4>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Card 4: PO Complete / Qty Rejected -->
          <div class="col-12 col-sm-6 col-lg-3">
            <div class="card hover-lift border-danger" style="border-left: 4px solid #dc3545;">
              <div class="card-body">
                <div class="d-flex justify-content-between align-items-start mb-3">
                  <h6 class="card-subtitle text-muted mb-0">PO Complete / Qty Rejected</h6>
                  <div class="fs-3">‚úÖ</div>
                </div>
                <div class="row">
                  <div class="col-6">
                    <p class="text-muted mb-1 small">PO Complete</p>
                    <h4 class="mb-0 text-success" id="poComplete">15</h4>
                  </div>
                  <div class="col-6">
                    <p class="text-muted mb-1 small">Qty Rejected</p>
                    <h4 class="mb-0 text-danger" id="qtyRejected">444</h4>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Charts -->
        <div class="row g-4 mt-2">
          <div class="col-12 col-lg-8" data-aos="fade-up" data-aos-delay="600">
            <div class="card">
              <div class="card-body">
                <h5 class="card-title mb-4">üìâ Monthly Rejection Rate Trend (Last 6 Months)</h5>
                <p class="text-muted small mb-3">Rejection percentage by month for selected product category</p>
                <canvas id="trendChart" height="80"></canvas>
              </div>
            </div>
          </div>
          <div class="col-12 col-lg-4" data-aos="fade-up" data-aos-delay="700">
            <div class="card">
              <div class="card-body">
                <h5 class="card-title mb-4">üìä Rejection by Inspection Stage</h5>
                <p class="text-muted small mb-3">Distribution of rejections across inspection stages</p>
                <canvas id="statusChart"></canvas>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>
  </div>

  <!-- Footer -->
  <footer class="border-top py-3 mt-4 text-center small text-muted">
    ¬© SARTHI - QIMS ‚Äî v0.1
  </footer>

  <!-- JS Libraries -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js"></script>
  <!-- App JS -->
  <script src="assets/js/app.js"></script>

  <script>
  // Page Loader
  window.addEventListener('load', () => {
    const loader = document.getElementById('pageLoader');
    setTimeout(() => {
      loader.style.opacity = '0';
      setTimeout(() => loader.style.display = 'none', 500);
    }, 1000);
  });

  // AOS Init
  AOS.init({ duration: 800, once: true });

  // ================================
  // üìä Chart Data for Each Product
  // ================================
  const chartDataSets = {
    ERC: {
      trend: [11.8, 10.7, 6.0, 5.9, 12.1, 12.4],
      status: [3.2, 2.9, 5.2],
      kpi: {
        poPlaced: 45, qtyOffered: 5200,
        poUnderInspection: 18, qtyInspected: 3444,
        poPending: 12, qtyAccepted: 3000,
        poComplete: 15, qtyRejected: 444
      }
    },
    Sleeper: {
      trend: [6.9, 11.0, 5.9, 13.6, 11.4, 12.0],
      status: [6.7, 5.9, 4.2],
      kpi: {
        poPlaced: 38, qtyOffered: 4200,
        poUnderInspection: 15, qtyInspected: 2800,
        poPending: 10, qtyAccepted: 2600,
        poComplete: 13, qtyRejected: 200
      }
    },
    GRSP: {
      trend: [6.6, 7.8, 7.0, 11.9, 8.4, 8.0],
      status: [4.4, 3.0, 5.1],
      kpi: {
        poPlaced: 28, qtyOffered: 2500,
        poUnderInspection: 11, qtyInspected: 1900,
        poPending: 8, qtyAccepted: 1700,
        poComplete: 9, qtyRejected: 200
      }
    },
    'Elastomeric Pad': {
      trend: [12.4, 14.3, 14.4, 10.6, 12.4, 12.4],
      status: [6.1, 2.5, 4.7],
      kpi: {
        poPlaced: 22, qtyOffered: 1800,
        poUnderInspection: 9, qtyInspected: 1500,
        poPending: 6, qtyAccepted: 1300,
        poComplete: 7, qtyRejected: 200
      }
    },
    Rail: {
      trend: [7.0, 5.2, 6.3, 9.5, 11.0, 8.8],
      status: [3.5, 3.0, 2.6],
      kpi: {
        poPlaced: 52, qtyOffered: 6500,
        poUnderInspection: 21, qtyInspected: 4200,
        poPending: 14, qtyAccepted: 4000,
        poComplete: 17, qtyRejected: 200
      }
    }
  };




  // ================================
  // üìà Initialize Charts
  // ================================
  let trendChartInstance = null;
  let statusChartInstance = null;

  function initCharts(product = 'ERC') {
    const trendCtx = document.getElementById('trendChart');
    const statusCtx = document.getElementById('statusChart');


    const productData = chartDataSets[product];

    // Trend Chart with Data Labels
    if (trendCtx) {
      if (trendChartInstance) trendChartInstance.destroy();
      trendChartInstance = new Chart(trendCtx, {
        type: 'bar',
        data: {
          labels: ['January', 'February', 'March', 'April', 'May', 'June'],
          datasets: [{
            label: `${product} Rejection Rate (%)`,
            data: productData.trend,
            borderColor: 'rgb(102, 126, 234)',
            backgroundColor: 'rgba(102, 126, 234, 0.7)',
            borderWidth: 1,
            borderRadius: 6
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              display: true,
              position: 'top',
              labels: {
                padding: 15,
                boxWidth: 20,
                font: { size: 13, weight: 'bold' }
              }
            },
            tooltip: {
              backgroundColor: 'rgba(0,0,0,0.8)',
              titleFont: { weight: 'bold', size: 14 },
              bodyFont: { size: 13 },
              padding: 12,
              callbacks: {
                label: function(context) {
                  return context.dataset.label + ': ' + context.parsed.y + '%';
                }
              }
            },
            datalabels: {
              display: true,
              color: '#333',
              font: { weight: 'bold', size: 11 },
              anchor: 'end',
              align: 'top',
              formatter: function(value) {
                return value + '%';
              }
            }
          },
          scales: {
            x: {
              grid: { display: false },
              ticks: {
                font: { size: 12 },
                color: '#666'
              },
              title: {
                display: true,
                text: 'Month',
                font: { size: 13, weight: 'bold' },
                color: '#333'
              }
            },
            y: {
              beginAtZero: true,
              grid: { color: 'rgba(0,0,0,0.08)' },
              ticks: {
                stepSize: 5,
                font: { size: 12 },
                color: '#666',
                callback: function(value) {
                  return value + '%';
                }
              },
              title: {
                display: true,
                text: 'Rejection Rate (%)',
                font: { size: 13, weight: 'bold' },
                color: '#333'
              }
            }
          }
        },
        plugins: [{
          // Custom plugin to draw data labels
          afterDatasetsDraw: function(chart) {
            const ctx = chart.ctx;
            chart.data.datasets.forEach(function(dataset, i) {
              const meta = chart.getDatasetMeta(i);
              if (!meta.hidden) {
                meta.data.forEach(function(element, index) {
                  ctx.fillStyle = '#333';
                  const fontSize = 11;
                  const fontStyle = 'bold';
                  const fontFamily = 'Arial';
                  ctx.font = Chart.helpers.fontString(fontSize, fontStyle, fontFamily);

                  const dataString = dataset.data[index] + '%';
                  ctx.textAlign = 'center';
                  ctx.textBaseline = 'bottom';

                  const padding = 5;
                  const position = element.tooltipPosition();
                  ctx.fillText(dataString, position.x, position.y - padding);
                });
              }
            });
          }
        }]
      });
    }


    // Status Chart with Data Labels
    if (statusCtx) {
      if (statusChartInstance) statusChartInstance.destroy();
      statusChartInstance = new Chart(statusCtx, {
        type: 'doughnut',
        data: {
          labels: ['Raw Material Stage', 'Process Stage', 'Final Inspection Stage'],
          datasets: [{
            label: 'Rejection %',
            data: productData.status,
            backgroundColor: [
              'rgba(102, 126, 234, 0.85)',
              'rgba(255, 193, 7, 0.85)',
              'rgba(220, 53, 69, 0.85)'
            ],
            borderColor: [
              'rgb(102, 126, 234)',
              'rgb(255, 193, 7)',
              'rgb(220, 53, 69)'
            ],
            borderWidth: 2
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              position: 'bottom',
              labels: {
                padding: 15,
                boxWidth: 20,
                font: { size: 12 }
              }
            },
            tooltip: {
              backgroundColor: 'rgba(0,0,0,0.8)',
              titleFont: { weight: 'bold', size: 14 },
              bodyFont: { size: 13 },
              padding: 12,
              callbacks: {
                label: function(context) {
                  const label = context.label || '';
                  const value = context.parsed || 0;
                  return label + ': ' + value + '%';
                }
              }
            },
            datalabels: {
              display: true,
              color: '#fff',
              font: { weight: 'bold', size: 13 },
              formatter: function(value, context) {
                return value + '%';
              }
            }
          }
        },
        plugins: [{
          // Custom plugin to draw percentage labels on slices
          afterDatasetsDraw: function(chart) {
            const ctx = chart.ctx;
            chart.data.datasets.forEach(function(dataset, i) {
              const meta = chart.getDatasetMeta(i);
              if (!meta.hidden) {
                meta.data.forEach(function(element, index) {
                  ctx.fillStyle = '#fff';
                  const fontSize = 13;
                  const fontStyle = 'bold';
                  const fontFamily = 'Arial';
                  ctx.font = Chart.helpers.fontString(fontSize, fontStyle, fontFamily);

                  const dataString = dataset.data[index] + '%';
                  ctx.textAlign = 'center';
                  ctx.textBaseline = 'middle';

                  const position = element.tooltipPosition();
                  ctx.fillText(dataString, position.x, position.y);
                });
              }
            });
          }
        }]
      });
    }

    // Update KPI Cards
    document.getElementById('poPlaced').textContent = productData.kpi.poPlaced;
    document.getElementById('qtyOffered').textContent = productData.kpi.qtyOffered.toLocaleString();
    document.getElementById('poUnderInspection').textContent = productData.kpi.poUnderInspection;
    document.getElementById('qtyInspected').textContent = productData.kpi.qtyInspected.toLocaleString();
    document.getElementById('poPending').textContent = productData.kpi.poPending;
    document.getElementById('qtyAccepted').textContent = productData.kpi.qtyAccepted.toLocaleString();
    document.getElementById('poComplete').textContent = productData.kpi.poComplete;
    document.getElementById('qtyRejected').textContent = productData.kpi.qtyRejected.toLocaleString();
  }

  // Initialize with ERC as default
  window.addEventListener('load', () => initCharts('ERC'));

  // ================================
  // üñ±Ô∏è Handle Product Toggle Buttons
  // ================================
  document.querySelectorAll('input[name="productToggle"]').forEach(btn => {
    btn.addEventListener('change', (e) => {
      if (e.target.checked) {
        const product = e.target.nextElementSibling.textContent.trim();
        console.log(`‚úÖ Selected Product: ${product}`);
        initCharts(product);
      }
    });
  });

  // ================================
  // üîç Handle Filter Dropdowns
  // ================================
  document.getElementById('zonalRailwayFilter').addEventListener('change', (e) => {
    const selectedZone = e.target.value;
    console.log(`üöÇ Zonal Railway Filter: ${selectedZone}`);
    // In a real application, this would filter the data
    // For now, we'll just log the selection
    if (selectedZone !== 'all') {
      console.log(`Filtering data for ${selectedZone}`);
      // You can add logic here to filter chartDataSets based on zone
    }
  });

  document.getElementById('ritesOfficeFilter').addEventListener('change', (e) => {
    const selectedOffice = e.target.value;
    console.log(`üè¢ RITES Office Filter: ${selectedOffice}`);
    // In a real application, this would filter the data
    // For now, we'll just log the selection
    if (selectedOffice !== 'all') {
      console.log(`Filtering data for ${selectedOffice} office`);
      // You can add logic here to filter chartDataSets based on office
    }
  });
</script>

</body>
</html>
